tinymce.PluginManager.add('embedpost', function (editor, url) {
    var openDialog = function () {
        return editor.windowManager.open({
            title: 'Embed social',
            body: {
                type: 'panel',
                items: [
                    {
                        type: 'urlinput',
                        name: 'source',
                        label: 'Embed code',
                        filetype: "embed",
                    }
                ]
            },
            buttons: [
                {
                    type: 'cancel',
                    text: 'Close'
                },
                {
                    type: 'submit',
                    text: 'Save',
                    primary: true
                }
            ],
            onSubmit: function (api) {
                var data = api.getData();
                // Insert content when the window form is submitted
                console.log(data);
                editor.insertContent('<div class="embed-card" style="max-width: 650px;" contenteditable="false" data-mce-style="max-width: 650px;" data-mce-selected="2">' + data.source.value + '<span class="mce-shim" data-mce-bogus="1"></span></div>');
                api.close();
            }
        });
    };

    // Add a button that opens a window
    editor.ui.registry.addButton('embedpost', {
        text: '<svg xmlns="http://www.w3.org/2000/svg" width="18.667" height="18.667" viewBox="0 0 14 14" fill="rgb(0%,0%,0%)"><path d="M12.97 2.332c0 1.047-.848 1.898-1.895 1.898S9.18 3.38 9.18 2.332 10.027.438 11.074.438s1.895.848 1.895 1.895zm0 0"/><path d="M11.074 4.668c-1.285 0-2.332-1.047-2.332-2.336S9.8 0 11.074 0s2.332 1.047 2.332 2.332a2.34 2.34 0 0 1-2.332 2.336zm0-3.793a1.46 1.46 0 0 0-1.457 1.457 1.46 1.46 0 0 0 1.457 1.461 1.46 1.46 0 0 0 1.457-1.461A1.46 1.46 0 0 0 11.074.875zm1.896 10.793c0 1.047-.848 1.895-1.895 1.895s-1.895-.848-1.895-1.895.848-1.898 1.895-1.898a1.9 1.9 0 0 1 1.895 1.898zm0 0"/><path d="M11.074 14c-1.285 0-2.332-1.047-2.332-2.332a2.34 2.34 0 0 1 2.332-2.336c1.285 0 2.332 1.047 2.332 2.336S12.36 14 11.074 14zm0-3.793a1.46 1.46 0 0 0-1.457 1.461 1.46 1.46 0 0 0 1.457 1.457 1.46 1.46 0 0 0 1.457-1.457 1.46 1.46 0 0 0-1.457-1.461zM4.805 7a1.9 1.9 0 0 1-1.898 1.895C1.86 8.895 1.012 8.047 1.012 7s.848-1.895 1.895-1.895S4.805 5.953 4.805 7zm0 0"/><path d="M2.906 9.332C1.62 9.332.574 8.285.574 7S1.62 4.668 2.906 4.668 5.242 5.715 5.242 7 4.195 9.332 2.906 9.332zm0-3.79c-.805 0-1.457.652-1.457 1.457s.652 1.457 1.457 1.457A1.46 1.46 0 0 0 4.367 7a1.46 1.46 0 0 0-1.461-1.457zm0 0"/><path d="M4.285 6.72a.58.58 0 0 1-.508-.293c-.16-.28-.062-.637.22-.797l5.4-3.086c.28-.16.637-.062.797.22a.58.58 0 0 1-.22.797l-5.4 3.086a.6.6 0 0 1-.289.074zm5.4 4.8a.57.57 0 0 1-.285-.074L3.996 8.37c-.28-.16-.38-.516-.22-.797s.516-.38.797-.22l5.414 3.086c.277.16.375.516.215.797a.58.58 0 0 1-.508.293zm0 0"/></svg>',
        onAction: function () {
            // Open window
            openDialog();
        }
    });

    // Adds a menu item, which can then be included in any menu via the menu/menubar configuration
    editor.ui.registry.addMenuItem('embedpost', {
        text: 'Embed Post',
        onAction: function () {
            // Open window
            openDialog();
        }
    });

    return {
        getMetadata: function () {
            return {
                name: "Embed custom plugin",
                url: "http://dejan"
            };
        }
    };
});
